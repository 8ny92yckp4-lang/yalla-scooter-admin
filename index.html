<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yalla Scooter - Stable Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #0088ff; --dark: #0a0a0a; --card: #151515; --success: #2ed573; --danger: #ff4757; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background-color: var(--dark); color: white; margin: 0; padding: 10px; }
        .box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #333; max-width: 500px; margin: auto; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        h1 { color: var(--blue); text-align: center; margin-bottom: 5px; font-size: 24px; }
        #net-status { text-align: center; font-size: 11px; margin-bottom: 15px; font-weight: bold; }
        .input-group { background: #000; padding: 15px; border-radius: 15px; border: 1px solid #222; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: var(--blue); }
        input { width: 100%; padding: 12px; background: #111; border: 1px solid #333; border-radius: 10px; color: white; margin-bottom: 10px; font-size: 16px; }
        input:focus { border-color: var(--blue); outline: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { cursor: pointer; border: none; border-radius: 12px; font-weight: bold; transition: 0.3s; padding: 15px; width: 100%; }
        .btn-main { background: var(--blue); color: white; font-size: 18px; margin-top: 5px; }
        .btn-now { background: #222; color: var(--blue); font-size: 11px; padding: 5px; margin-bottom: 10px; border: 1px solid var(--blue); }
        .btn-break { background: #1a0000; border: 1px solid var(--danger); color: var(--danger); margin-top: 10px; font-size: 14px; }
        .revenue-card { background: linear-gradient(135deg, var(--blue), #004488); color: white; padding: 15px; border-radius: 15px; text-align: center; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 15px; }
        th { color: #888; padding: 10px; border-bottom: 1px solid #333; text-align: center; }
        td { padding: 10px; text-align: center; border-bottom: 1px solid #111; }
        .error-line { font-size: 10px; color: var(--danger); display: block; background: rgba(255,0,0,0.1); padding: 5px; border-radius: 5px; }
        #login-screen { height: 90vh; display: flex; align-items: center; justify-content: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="box" style="text-align: center; width: 100%;">
            <h1>Yalla Scooter ğŸ›´</h1>
            <input type="password" id="pass" placeholder="Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„" style="text-align: center;">
            <button class="btn-main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="app" class="box hidden">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø­Ù„Ø§Øª</h1>
        <div id="net-status">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
        <div class="input-group">
            <label>Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
            <input type="text" id="staff" placeholder="Ø§Ø³Ù…Ùƒ">
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¥Ø³ÙƒÙˆØªØ±</label>
            <input type="text" id="scooter" placeholder="S-01">
            <div class="grid">
                <div>
                    <label>Ø®Ø±ÙˆØ¬</label><input type="time" id="startTime">
                    <button class="btn-now" onclick="setT('startTime')">Ø§Ù„Ø¢Ù†</button>
                </div>
                <div>
                    <label>Ø±Ø¬ÙˆØ¹</label><input type="time" id="endTime">
                    <button class="btn-now" onclick="setT('endTime')">Ø§Ù„Ø¢Ù†</button>
                </div>
            </div>
        </div>
        <button class="btn-main" onclick="saveTrip(false)">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© ÙˆØ§Ù„Ø­Ø³Ø§Ø¨ âœ…</button>
        <button class="btn-break" onclick="saveTrip(true)">ğŸš¨ ØªØ³Ø¬ÙŠÙ„ Ø¹Ø·Ù„ ÙÙ†ÙŠ Ø£Ùˆ Ø®ØµÙ…</button>
        <div class="revenue-card">
            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¯Ø®Ù„ ÙŠÙˆÙ… <span id="displayDate"></span></small>
            <h2 id="totalDisplay" style="margin:5px 0">0.00 Ø¬.Ù…</h2>
        </div>
        <input type="date" id="viewDate" onchange="loadHistory()" style="margin-bottom:10px">
        <table id="logTable">
            <thead><tr><th>Ø³ÙƒÙˆØªØ±</th><th>ÙˆÙ‚Øª</th><th>Ù…Ø¯Ø©</th><th>ØµØ§ÙÙŠ</th></tr></thead>
            <tbody id="logBody"></tbody>
        </table>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCJOSLUFRAZV4YWYFDB9VLvju",
        authDomain: "yala-scooter.firebaseapp.com",
        databaseURL: "https://yalla-scooter-default-rtdb.firebaseio.com",
        projectId: "yala-scooter",
        storageBucket: "yala-scooter.firebasestorage.app",
        messagingSenderId: "1014076976512",
        appId: "1:1014076976512:web:c053191787884674720970"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref(".info/connected").on("value", s => {
        const bar = document.getElementById('net-status');
        bar.innerText = s.val() ? "â— Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©" : "â—‹ ØºÙŠØ± Ù…ØªØµÙ„!";
        bar.style.color = s.val() ? "#2ed573" : "#ff4757";
    });

    function login() {
        if(document.getElementById('pass').value === "1234") {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('viewDate').value = today;
            document.getElementById('staff').value = localStorage.getItem('yStaff') || '';
            loadHistory();
        } else { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯!"); }
    }

    function setT(id) {
        const n = new Date();
        document.getElementById(id).value = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0');
    }

    async function saveTrip(isIssue = false) {
        const staff = document.getElementById('staff').value;
        const scooter = document.getElementById('scooter').value.toUpperCase();
        const start = document.getElementById('startTime').value;
        const end = document.getElementById('endTime').value;

        if(!staff || !scooter || !start || !end) return alert("âš ï¸ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        let reason = "Ø³Ù„ÙŠÙ… âœ…"; let discount = 0;
        if(isIssue) {
            const r = prompt("Ù…Ø§ Ù‡Ùˆ Ø³Ø¨Ø¨ Ø§Ù„Ø¹Ø·Ù„ØŸ"); if(r === null) return;
            reason = r || "Ø¹Ø·Ù„ ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
            discount = parseFloat(prompt("Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…ØŸ")) || 0;
        }

        const t1 = new Date("2026-01-01 " + start);
        let t2 = new Date("2026-01-01 " + end);
        if(t2 < t1) t2.setDate(t2.getDate() + 1);
        
        const mins = Math.max(1, Math.floor((t2 - t1) / 60000));
        const cost = Math.max(0, (mins * 2) - discount);

        const today = new Date().toISOString().split('T')[0];
        if(confirm(`ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­ÙØ¸ØŸ Ø§Ù„ØµØ§ÙÙŠ: ${cost} Ø¬`)) {
            try {
                await db.ref('history/' + today).push({ staff, scooter, start, end, mins, cost, discount, reason });
                alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸");
                document.getElementById('scooter').value = "";
                document.getElementById('startTime').value = "";
                document.getElementById('endTime').value = "";
            } catch (e) { alert("Ø®Ø·Ø£: " + e.message); }
        }
    }

    function loadHistory() {
        const date = document.getElementById('viewDate').value;
        db.ref('history/' + date).on('value', (snap) => {
            const data = snap.val();
            const tbody = document.getElementById("logBody");
            tbody.innerHTML = ""; let total = 0;
            if(data) {
                Object.values(data).reverse().forEach(t => {
                    tbody.innerHTML += `<tr><td><b>${t.scooter}</b></td><td>${t.start}-${t.end}</td><td>${t.mins}Ø¯</td><td>${t.cost}Ø¬</td></tr>`;
                    if(t.reason !== "Ø³Ù„ÙŠÙ… âœ…") tbody.innerHTML += `<tr><td colspan="4"><span class="error-line">âš ï¸ ${t.reason}</span></td></tr>`;
                    total += parseFloat(t.cost);
                });
            }
            document.getElementById('totalDisplay').innerText = total.toFixed(2) + " Ø¬.Ù…";
        });
    }
</script>
</body>
</html>
